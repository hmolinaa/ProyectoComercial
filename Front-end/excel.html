<!DOCTYPE html>
<html>

<head>
    <title>Enviar archivo Excel</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
</head>

<body>
    <h1>Enviar un  archivo Excel</h1>
    <input type="file" id="fileInput">
    <button onclick="enviarArchivo()">Enviar archivo</button>
    <div id="tablaResultados"></div>

    <h1>Tabla de Resultados</h1>
    <table id="items-table" class="table table-hover table-bordered" WIDTH="70%">
        <thead>
            <tr class="table-warning">
                <th>Nombre</th>
                <th>Apellido</th>
                <th>Cuenta</th>
                <th>Asignatura</th>
                <th>Parcial-1</th>
                <th>Parcial-2</th>
                <th>Parcial-3</th>
                <th>Nota Final</th>
                <th>Correo</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <script>

        async function enviarArchivo() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];

            if (file) {
                const formData = new FormData();
                formData.append('file', file);

                try {
                    const response = await fetch('http://localhost:8080/excel', {
                        method: 'POST',
                        body: formData,
                        headers: {
                            'Content-Type': 'multipart/form-data',
                        },
                    });

                    if (response.ok) {
                        const data = await response.json();
                        mostrarTabla(data);
                    } else {
                        console.log('Error en la solicitud Fetch:', response.status, response.statusText);
                    }
                } catch (error) {
                    console.log('Error al enviar la solicitud Fetch:', error.message);
                }
            } else {
                console.log('Por favor, selecciona un archivo.');
            }
        }


        function procesarArchivoExcel(fileContent) {

            //  SheetJS (https://sheetjs.com/) 

            return new Promise((resolve, reject) => {
                const workbook = XLSX.read(fileContent, { type: 'binary' });
                const jsonData = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]]);
                resolve(jsonData);
            });
        }

        function mostrarTabla(data) {
            if (Array.isArray(data)) {
                const tableBody = document.querySelector("#items-table tbody");
                if (tableBody) {
                    tableBody.innerHTML = "";

                    
                    data.forEach(item => {
                        const row = document.createElement("tr");


                        tableBody.appendChild(row);
                    });
                } else {
                    console.log("Error: El elemento tbody de la tabla no se encontr√≥ en el DOM.");
                }
            } else {
                console.log("Error: Los datos recibidos no son un array.");
            }
        }


    </script>
</body>

</html>