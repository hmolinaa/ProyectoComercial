<!DOCTYPE html>
<html>

<head>
    <title>My website</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.4/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>


</head>

<body>
    <nav class="navbar navbar-expand-sm bg-dark navbar-dark sticky-top">
        <a class="navbar-brand" href="#">
            <img src="https://wallpaperaccess.com/full/3723924.png" alt="Logo" style="width:50px;">
        </a>

        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-item nav-link active" href="principal.html"> Inicio</a>
            </li>
            <li class="nav-item">
                <a class="nav-item nav-link " href="inicio.html">Calificaciones de los estudiantes <span
                        class="sr-only">(current)</span></a>
            </li>
        </ul>

    </nav>
    <div class="container" style="margin-top:30px">



        <h5 class="text-primary"> Subir archivo Excel </h5>
        <input type="file" id="fileInput">
        <button onclick="enviarArchivo()">Enviar Archivo</button>
        <br />
        <br />

        <h5 class="text-secondary"> Vista de calificaciones de cada estudiante </h5>
        <br />
        <table id="items-table" class="table table-hover table-bordered" WIDTH="100%">
            <thead>
                <tr class="table-warning">
                    <th>Nombre</th>
                    <th>Apellido</th>
                    <th>Cuenta</th>
                    <th>Asignatura</th>
                    <th>Parcial 1</th>
                    <th>Parcial 2</th>
                    <th>Parcial 3</th>
                    <th>Nota Final</th>
                    <th>Correo</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>

        <script>
            async function enviarArchivo() {
                const fileInput = document.getElementById('fileInput');
                const file = fileInput.files[0];

                if (file) {
                    const reader = new FileReader();

                    reader.onload = async (event) => {
                        try {
                            const jsonData = await procesarArchivoExcel(event.target.result);

                            console.log('JSON generado en el frontend:', jsonData); // Imprimir el JSON en la consola

                            // Convertir el JSON a una cadena
                            const jsonString = JSON.stringify(jsonData);

                            // Configurar el cuerpo de la solicitud con el contenido del JSON
                            const requestOptions = {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: jsonString,
                            };

                            // Realizar la solicitud Fetch POST
                            const response = await fetch('http://localhost:8080/excel', requestOptions);

                            if (response.ok) {
                                const data = await response.json();
                                mostrarTabla(data);
                            } else {
                                console.log('Error en la solicitud Fetch:', response.status, response.statusText);
                            }
                        } catch (error) {
                            console.log('Error al procesar el archivo Excel:', error.message);
                        }
                    };

                    reader.readAsBinaryString(file);
                } else {
                    console.log('Por favor, selecciona un archivo.');
                }
            }

            async function procesarArchivoExcel(fileContent) {
                return new Promise((resolve, reject) => {
                    const workbook = XLSX.read(fileContent, { type: 'binary' });

                    // Supongamos que los datos se encuentran en la primera hoja (Sheet) del archivo Excel
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];

                    // Convertir el archivo Excel a un arreglo de objetos JSON
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);

                    resolve(jsonData);
                });
            }

            function mostrarTabla(data) {
                const tableBody = document.querySelector('#items-table tbody');

                // Limpiar la tabla antes de agregar nuevos datos
                tableBody.innerHTML = '';

                // Iterar sobre los datos y agregar filas a la tabla
                data.forEach((item) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                <td>${item.Nombre}</td>
                <td>${item.Apellido}</td>
                <td>${item.Cuenta}</td>
                <td>${item['Asignatura']}</td>
                <td>${item['Parcial 1']}</td>
                <td>${item['Parcial 2']}</td>
                <td>${item['Parcial 3']}</td>
                <td>${item['Nota Final']}</td>
                <td>${item.Correo}</td>
                 `;
                    tableBody.appendChild(row);
                });
            }

        </script>
        <br />
        <a name="" id="" class="btn btn-success" href="http://localhost:8080/send-emails" role="button">Enviar correo
            personalizado a todos</a>
        

    </div>
    <br />

</body>
<footer class="bg-dark text-center text-white" style="margin-bottom:0">
    <!-- Grid container -->
    <div class="container p-4 pb-0">
      <!-- Section: Social media -->
      <section class="mb-4">
  
        <!-- Facebook -->
        <a class="btn btn-outline-light btn-floating m-1" href="https://www.facebook.com/profile.php?id=100004134270409"
          role="button"><i class="fab fa-facebook-f">FACEBOOK</i></a>
  
        <!-- Instagram -->
        <a class="btn btn-outline-light btn-floating m-1" href="https://www.instagram.com/hmolinaa_25/" role="button"><i
            class="fab fa-instagram">INSTAGRAM</i></a>
  
        <!-- Github -->
        <a class="btn btn-outline-light btn-floating m-1" href="https://github.com/hmolinaa" role="button"><i
            class="fab fa-github">GIT-HUB</i></a>
  
      </section>
      <!-- Section: Social media -->
    </div>
    <!-- Grid container -->
  
    <!-- Copyright -->
    <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.2);">
      Â© 2023 Copyright:
      <a class="text-white" href="https://github.com/hmolinaa/">Henrry Molina</a>
    </div>
    <!-- Copyright -->
  </footer>

</html>